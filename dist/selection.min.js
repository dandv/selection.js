(function(a){typeof define=="function"?define(a):typeof require=="function"?a(require,exports,module):a()})(function(a,b,c){function f(a,b){return this.element=a,this.cursor=function(a,c){var d=this.element;if(typeof a=="undefined")return b?k(d):[d.selectionStart,d.selectionEnd];if(i(a)){var e=a;a=e[0],c=e[1]}return typeof c=="undefined"&&(c=a),b?l(d,a,c):d.setSelectionRange(a,c),this},this}function g(a){if(!a){var b=d.getSelection();this.element=n(b),this.text=function(){return b.toString()}}else this.text=function(){return document.selection.createRange().text};return this}function k(a){var b=document.selection.createRange(),c=0;if(b&&b.parentElement()===a){var d,e,f=a.value.replace(/\r\n/g,"\n"),g=f.length,h=a.createTextRange();h.moveToBookmark(b.getBookmark());var i=a.createTextRange();return i.collapse(!1),h.compareEndPoints("StartToEnd",i)>-1?d=e=g:(d=-h.moveStart("character",-g),e=-h.moveEnd("character",-g)),e<d&&(e=g),[d,e]}return[0,0]}function l(a,b,c){var d=a.createTextRange();d.move("character",b),d.moveEnd("character",c-b),d.select()}function m(a,b,c,d,e){typeof b=="undefined"&&(b="");var f=a.element.value;return a.element.value=[f.slice(0,c),b,f.slice(d)].join(""),d=c+b.length,e==="left"?a.cursor(c):e==="right"?a.cursor(d):a.cursor(c,d),a}function n(a){var b=null,c=a.anchorNode,d=a.focusNode;while(!b){if(c.parentElement===d.parentElement){b=d.parentElement;break}c=c.parentElement,d=d.parentElement}return b}var d=this,e;f.prototype.text=function(a,b){var c=this.element,d=this.cursor();return typeof a=="undefined"?c.value.slice(d[0],d[1]):m(this,a,d[0],d[1],b)},f.prototype.append=function(a,b){var c=this.cursor()[1];return m(this,a,c,c,b)},f.prototype.prepend=function(a,b){var c=this.cursor()[0];return m(this,a,c,c,b)},f.prototype.surround=function(a){typeof a=="undefined"&&(a=1);var b=this.element.value,c=this.cursor(),d=b.slice(Math.max(0,c[0]-a),c[0]),e=b.slice(c[1],c[1]+a);return[d,e]},f.prototype.line=function(){var a=this.element.value,b=this.cursor(),c=a.slice(0,b[0]).lastIndexOf("\n"),d=a.slice(b[1]).indexOf("\n"),e=c+1;if(d===-1)return a.slice(e);var f=b[1]+d;return a.slice(e,f)},e=function(a){a&&a.length&&(a=a[0]);if(a){if(typeof a.selectionStart!="undefined")return new f(a);var b=a.tagName.toLowerCase()}if(!b||b!=="textarea"&&b!=="input"){if(d.getSelection)return new g;if(document.selection)return new g(!0);throw"your browser is very weired"}return new f(a,!0)};var h=Object.prototype.toString,i=Array.isArray;i||(i=function(a){return h.call(a)==="[object Array]"});var j=function(a){return h.call(a)==="[object Function]"};typeof c!="undefined"?c.exports=e:d.selection=e,typeof jQuery!="undefined"&&(jQuery.fn.selection=e)});